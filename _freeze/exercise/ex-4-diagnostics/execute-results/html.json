{
  "hash": "943e68c547a6d7ee66f8c77792b36897",
  "result": {
    "markdown": "---\ntitle: \"Exercise 4: Diagnostics\"\neditor: source\nreference-location: margin\n---\n\n\n::: callout-note\nExercises are for practice purpose only.\n:::\n\n\n\n## Diagnostics\n\n<!-- Yu -->\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ISLR2)\n```\n:::\n\n\n1. This problem involves the `Boston` data set. We now try to predict per capita crime rate using the median value of owner-occupied homes.\n\na. Fit a simple linear regression model. Check if there are any leverage points and outliers.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmout <- lm(crim ~ medv, data = Boston)\nhat_i <- hatvalues(lmout)\np <- 2\nn <- dim(Boston)[1]\nhat_i[hat_i > 2 * p/n]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n         98          99         158         162         163         164 \n0.008095218 0.012564598 0.010221559 0.019638086 0.019638086 0.019638086 \n        167         181         187         196         203         204 \n0.019638086 0.008956196 0.019638086 0.019638086 0.011123659 0.017761716 \n        205         225         226         229         233         234 \n0.019638086 0.013583750 0.019638086 0.015649129 0.010576780 0.017519493 \n        254         257         258         262         263         268 \n0.011592267 0.012764683 0.019638086 0.011879050 0.018128562 0.019638086 \n        269         281         283         284         369         370 \n0.012267983 0.014217715 0.014868535 0.019638086 0.019638086 0.019638086 \n        371         372         373         399         400         401 \n0.019638086 0.019638086 0.019638086 0.009172585 0.008144984 0.008688476 \n        406 \n0.009172585 \n```\n:::\n\n```{.r .cell-code}\nr_student <- rstudent(lmout)\nr_student[r_student > 2]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n      379       381       387       399       404       405       406       411 \n 2.104670 11.482458  2.080661  3.635469  2.032062  4.218608  7.754484  5.836445 \n      414       415       418       419       428 \n 2.896013  4.712929  2.274124  8.812265  3.818927 \n```\n:::\n:::\n\n\nb. Check the normality, constant variance and linearity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## normality\ncar::qqPlot(lmout, id = TRUE, col.lines = \"blue\", \n            reps = 1000, ylab = \"Ordered R-Student Residuals\", pch = 16)\n```\n\n::: {.cell-output-display}\n![](ex-4-diagnostics_files/figure-html/unnamed-chunk-3-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 381 419\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## normality\nrstud <- rstudent(lmout)\ncar::densityPlot(rstud)\n```\n\n::: {.cell-output-display}\n![](ex-4-diagnostics_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## constant variance\ncar::scatterplot(fitted(lmout), rstudent(lmout), \n            smooth = list(span = 2/3, lwd.smooth = 3, lwd.spread = 4), \n            regLine = FALSE, boxplots = FALSE, main = \"crim as y\",\n            xlab = \"Fitted Values\", ylab = \"R-Student Residuals\")\nabline(a = 0, b = 0, col = 2, lwd = 2)\n```\n\n::: {.cell-output-display}\n![](ex-4-diagnostics_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n## linearity\ncar::crPlots(lmout, ylab = \"partial residual\", grid = FALSE, main = \"\")\n```\n\n::: {.cell-output-display}\n![](ex-4-diagnostics_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\nc. Transformming $y$ to satisfy linear regression assumptions.\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlmout_log <- lm(log(crim) ~ poly(medv, degree = 2, raw = TRUE), data = Boston)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncar::densityPlot(rstudent(lmout_log))\n```\n\n::: {.cell-output-display}\n![](ex-4-diagnostics_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncar::scatterplot(fitted(lmout_log), rstudent(lmout_log), \n            smooth = list(span = 2/3, lwd.smooth = 3, lwd.spread = 4), \n            regLine = FALSE, boxplots = FALSE, main = \"log(crim) as y, medv^2 as x\",\n            xlab = \"Fitted Values\", ylab = \"R-Student Residuals\")\nabline(a = 0, b = 0, col = 2, lwd = 2)\n```\n\n::: {.cell-output-display}\n![](ex-4-diagnostics_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncar::crPlots(lmout_log, ylab = \"partial residual\", grid = FALSE, main = \"\")\n```\n\n::: {.cell-output-display}\n![](ex-4-diagnostics_files/figure-html/unnamed-chunk-10-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "ex-4-diagnostics_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}